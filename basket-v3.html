<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Buyer – Basket</title>

<style>
body{
  font-family: Arial;
  background:#f5f5f5;
  margin:0;
}
header{
  background:#fff;
  padding:12px;
  border-bottom:1px solid #ddd;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.container{
  padding:14px;
}
.card{
  background:#fff;
  padding:12px;
  border-radius:6px;
  border:1px solid #ddd;
  margin-bottom:10px;
}
.card small{
  color:#555;
}
.total{
  font-weight:bold;
  font-size:16px;
  margin-top:10px;
  text-align:right;
}
.notice{
  background:#fff3cd;
  border:1px solid #ffeeba;
  padding:10px;
  border-radius:6px;
  margin-bottom:10px;
  font-size:13px;
}
.empty{
  color:#666;
}
</style>
</head>

<body>

<header>
  <b>My Basket</b>
  <a href="buyer-feed.html">← Back</a>
</header>

<div class="container">
  <div id="notice" class="notice" style="display:none;"></div>
  <div id="basket">Loading basket…</div>
</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbzOutSpXzb0zfR5ZkJ1iq-1a1m4WImhpvn26M5oMxXzTb9J28o2rJWRG26IA2dEV3us/exec";
const BUYER_ID = "BUY001";
const SUPPLIER_ID = "SUP001";

fetch(`${API}?action=getSupplierBaskets&supplierId=${SUPPLIER_ID}`)
  .then(r => r.json())
  .then(j => {
    const baskets = j.data || [];
    const basket = baskets.find(b => b.buyerId === BUYER_ID);

    if (!basket || basket.items.length === 0) {
      document.getElementById("basket").innerHTML =
        "<div class='empty'>Your basket is empty.</div>";
      return;
    }

    renderBasket(basket);
  });

function renderBasket(b){
  let html = "";
  let grandTotal = 0;

  b.items.forEach(i => {
    const amount = i.pcs * i.pricePerPC;
    const gstAmt = amount * i.gstPercent / 100;
    const total = amount + gstAmt;

    grandTotal += total;

    html += `
      <div class="card">
        <b>${i.productName}</b><br>
        <small>Sets: ${i.sets} | Pcs: ${i.pcs}</small><br>
        <small>Rate: ₹${i.pricePerPC} + ${i.gstPercent}% GST</small><br>
        <small>Item Total: ₹${total.toFixed(2)}</small>
      </div>
    `;
  });

  html += `<div class="total">Grand Total: ₹${grandTotal.toFixed(2)}</div>`;

  document.getElementById("basket").innerHTML = html;

  document.getElementById("notice").style.display = "block";
  document.getElementById("notice").innerText =
    "Basket sent to supplier for review. Stock will be locked once approved.";
}
</script>

</body>
</html>

<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Buyer Feed</title>
<style>
body{font-family:Arial;background:#f5f5f5;margin:0}
header{background:#fff;padding:12px;border-bottom:1px solid #ddd}
.batch{padding:12px}
.card{background:#fff;padding:10px;margin-top:8px;display:flex;gap:10px}
img{width:70px;height:90px;object-fit:cover}
</style>
</head>

<body>
<header><b>Stock Updates</b></header>
<div id="feed"></div>

<script>
const API="https://script.google.com/macros/s/AKfycbzOutSpXzb0zfR5ZkJ1iq-1a1m4WImhpvn26M5oMxXzTb9J28o2rJWRG26IA2dEV3us/exec";
const BUYER_ID="BUY001";
const SUPPLIER_ID="SUP001";

fetch(`${API}?action=getSupplierUpdates&supplierId=${SUPPLIER_ID}`)
.then(r=>r.json()).then(j=>{
j.data.forEach(b=>{
const d=document.createElement("div");
d.className="batch";
d.innerHTML=`<small>${new Date(b.batchTime).toLocaleString()}</small>`;
b.products.forEach(p=>{
d.innerHTML+=`
<div class="card">
<img src="${p.imageURLs[0]||''}">
<div>
<b>${p.productName}</b><br>
${p.description}<br>
Sizes: ${p.sizes.join(", ")}<br>
â‚¹${p.pricePerPC}+${p.gstPercent}% GST<br>
<button onclick="add('${b.batchId}','${p.productCode}')">Add</button>
</div></div>`;
});
feed.appendChild(d);
});
});

function add(batch,code){
const s=prompt("Sets");
fetch(`${API}?action=addToBasket&buyerId=${BUYER_ID}&supplierId=${SUPPLIER_ID}&batchId=${batch}&productCode=${code}&sets=${s}`)
.then(()=>alert("Added"));
}
</script>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Buyer – My Orders</title>

<style>
body{
  font-family: Arial, sans-serif;
  background:#f5f5f5;
  margin:0;
}
header{
  background:#fff;
  padding:12px;
  border-bottom:1px solid #ddd;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.container{
  padding:14px;
}
.card{
  background:#fff;
  border:1px solid #ddd;
  border-radius:6px;
  padding:12px;
  margin-bottom:10px;
}
.card small{
  color:#555;
}
.status{
  font-weight:bold;
  margin-top:4px;
}
button{
  margin-top:8px;
  padding:8px 12px;
  background:#000;
  color:#fff;
  border:none;
  cursor:pointer;
}
.empty{
  color:#666;
}
</style>
</head>

<body>

<header>
  <b>My Orders</b>
  <a href="buyer-feed.html">← Back</a>
</header>

<div class="container" id="orders">
  Loading orders…
</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbzOutSpXzb0zfR5ZkJ1iq-1a1m4WImhpvn26M5oMxXzTb9J28o2rJWRG26IA2dEV3us/exec";
const BUYER_ID = "BUY001";

/* Load buyer orders on page load */
fetch(`${API}?action=getOrdersForBuyer&buyerId=${BUYER_ID}`)
  .then(r => r.json())
  .then(j => render(j.data || []));

function render(list){
  const el = document.getElementById("orders");
  el.innerHTML = list.length ? "" : "<div class='empty'>No orders yet</div>";

  list.forEach(o => {
    const orderId = o.orderId || o[0];
    const supplierId = o.supplierId || o[2];
    const orderStatus = o.orderStatus || o[5];
    const dispatchStatus = o.dispatchStatus || o[7];
    const transport = o.transport || o[8];
    const tracking = o.tracking || o[9];

    const div = document.createElement("div");
    div.className = "card";

    div.innerHTML = `
      <b>Order ID:</b> ${orderId}<br>
      <small>Supplier: ${supplierId}</small><br>

      <div class="status">
        Order: ${orderStatus} <br>
        Dispatch: ${dispatchStatus}
      </div>

      ${dispatchStatus === "DISPATCHED" ? `
        <small>Transport: ${transport}</small><br>
        <small>Tracking / LR: ${tracking}</small><br>
      ` : ""}

      <button onclick="printOrder('${orderId}')">
        Print Order
      </button>
    `;

    el.appendChild(div);
  });
}

function printOrder(orderId){
  window.open(
    `${API}?action=printOrder&orderId=${orderId}`,
    "_blank"
  );
}
</script>

</body>
</html>

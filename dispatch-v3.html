<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Supplier – Dispatch Orders</title>

<style>
body{
  font-family:Arial;
  background:#f4f4f4;
  margin:0;
}
header{
  background:#fff;
  padding:12px;
  border-bottom:1px solid #ddd;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.card{
  background:#fff;
  margin:14px;
  padding:14px;
  border-radius:6px;
  border:1px solid #ddd;
}
.order{
  border:1px solid #ddd;
  padding:10px;
  border-radius:6px;
  margin-top:10px;
}
.order small{
  color:#555;
}
input{
  width:100%;
  padding:8px;
  margin-top:6px;
}
button{
  margin-top:8px;
  padding:8px 12px;
  background:#000;
  color:#fff;
  border:none;
  cursor:pointer;
}
</style>
</head>

<body>

<header>
  <b>Dispatch Orders</b>
  <a href="supplier.html">← Back</a>
</header>

<div id="orders">Loading orders…</div>

<script>
const API="https://script.google.com/macros/s/AKfycbzOutSpXzb0zfR5ZkJ1iq-1a1m4WImhpvn26M5oMxXzTb9J28o2rJWRG26IA2dEV3us/exec";
const SUPPLIER_ID="SUP001";

/* Load orders on page load */
fetch(`${API}?action=getOrders&supplierId=${SUPPLIER_ID}`)
  .then(r=>r.json())
  .then(j=>render(j.data||[]));

function render(list){
  const el=document.getElementById("orders");
  el.innerHTML=list.length ? "" : "No orders to dispatch";

  list.forEach(o=>{
    const div=document.createElement("div");
    div.className="card order";

    div.innerHTML=`
      <b>Order ID:</b> ${o[0] || o.orderId}<br>
      <small>Buyer: ${o[3] || o.buyerId}</small><br>
      <small>Status: ${o[5] || o.orderStatus}</small><br>
      <small>Dispatch: ${o[7] || o.dispatchStatus}</small>

      <input placeholder="Transport name" id="t_${o[0] || o.orderId}">
      <input placeholder="Tracking / LR number" id="r_${o[0] || o.orderId}">

      <button onclick="dispatch('${o[0] || o.orderId}')">
        Mark as Dispatched
      </button>
    `;

    el.appendChild(div);
  });
}

function dispatch(orderId){
  const transport=document.getElementById("t_"+orderId).value;
  const tracking=document.getElementById("r_"+orderId).value;

  fetch(`${API}?action=dispatchOrder`
    + `&orderId=${orderId}`
    + `&transport=${encodeURIComponent(transport)}`
    + `&tracking=${encodeURIComponent(tracking)}`
  ).then(()=>{
    alert("Order dispatched");
    location.reload();
  });
}
</script>

</body>
</html>
